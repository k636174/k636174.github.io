---
    layout: post
    title: "オンプレで構築した家計簿分析基盤をAWSに移行する（Part0. キックオフ)"
    date: 2020-05-23
    permalink: /aws_migration_part0
    tags:
    - クラウド
    - AWS
    - AWS移行計画
    image: /assets/images/20200523_before_env.png
---

## 概要

コロナ自粛の2020年5月のGWでやることも無く、暇を持て余して構築した「[家計簿アプリの情報をMariaDBに入れてカッチョ良く表示する](/zaim_scraper)」をAWS上に移行するお話です。  
※長くなりそうなので複数記事に分けて投稿していきます。  
※本音はAWS Certified Solutions Architect – Associate (SAA-C02)の勉強を兼ねてのお遊びで実施。


## 今回の移行完了までのお品書き

ざっくりと、下記のような流れで勧めていきます。  
(ひとつの記事に全て書きだすと長くなりそうなので分割して記載してきます。)

1. 現行環境の把握(このポスト)
1. AWSへの移行計画の策定（後日投稿します）
1. AWSへの移行フェーズ（後日投稿します）
1. 実運用の開始（後日投稿します）


## 現行の把握
 ![before_env](/assets/images/20200523_before_env.png "before_env")  
### 現行環境の課題
* DCに借りてるサーバが、稀に障害等でダウンし利用が出来ない時がある。(※1)
* オンプレ環境上に構築しているのでインフラのメンテナンスが必要。
* 可用性を手軽に上げたい。

※1：月額$50ドルのプランでかなりのリソースを提供してもらっており契約の範囲内のダウンなのでホスティング事業者を責めてるわけじゃない。

### 現行環境の構成とコスト
1. インフラ
    * オンプレのWindowsServer2012R2で構築したHyper−V上にCentOS入れてその上でコンテナ動かしてサービス提供。
    * UTMのSophosXGのHomeエディションを入れたVMで通信を監視。
1. アプリの機能と構成
    * Pythonで下記実行するスクリプトを準備
        * SeleniumでZaimから取引記録CSVと口座残高を保存する。（必要な時に手動で起動）
        * MariaDBに↑で取得したCSVをDBに格納する。
        * DBに格納済みCSVは破棄せずバックアップディレクトリに移動させる。
    * スクリプトは、SSH経由でiPhoneのショートカット機能からキック
    * GrafanaでMariaDBに格納されているデータを表示し分析する。
1. オンプレで借りている専用サーバのスペック

    |  項目  |  --  |
    | ---- | ---- |
    | IP | /29のIPv4 Block |
    |  Bandwidth  | 1Gbit Port  |
    |  Processor  | E5520@2.27GHz x 2  |
    |  Ram  | 24 GiB|
    |  Disk  | 240GB(SSD) + 3TB(HDD)  |
    | 設置場所 | アメリカ |
    | 月額料金 |$50 |

1. その他備考
    * GrafanaへのアクセスやVMへのSSHログイン時に使うサブドメインは、既にRoute53で名前解決するよう対処済み。
           
## 今後のざっくりスケジュール
1. 現行環境の把握(...2020/05/23　Done)
1. AWSへの移行計画の策定（...2020/05/31 完了予定）
1. AWSへの移行フェーズ（...2020/06/14 完了予定）
1. 実運用の開始（...2020/06/28 完了予定）
 